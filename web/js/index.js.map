{"version":3,"file":"index.js","sources":["../src/debugString.ts"],"sourcesContent":["import { app } from '@comfyorg/comfyui-frontend/src/scripts/app';\r\nimport { ComfyWidgets } from '@comfyorg/comfyui-frontend/src/scripts/widgets';\r\nimport type { ComfyExtension, NodeInstance } from '@comfyorg/comfyui-frontend/src/types/comfy';\r\n\r\nconst extension: ComfyExtension = {\r\n  name: \"TypeScript-CustomNode.DebugString\",\r\n  beforeRegisterNodeDef: async (nodeType, nodeData, app) => {\r\n    if (nodeData.name !== \"DebugString\") return;\r\n\r\n    const debugString = (nodeInstance: NodeInstance, content: string) => {\r\n      if (!nodeInstance.widgets) return;\r\n\r\n      // 既存のウィジェットをクリア\r\n      nodeInstance.widgets.slice(1).forEach(widget => widget.onRemove?.());\r\n      nodeInstance.widgets.length = 1;\r\n\r\n      const values = content ? [...content] : [];\r\n      values.forEach(list => {\r\n        const w = ComfyWidgets[\"STRING\"](nodeInstance, \"content\", [\"STRING\", { multiline: true }], app).widget;\r\n        w.inputEl.readOnly = true;\r\n        w.inputEl.style.opacity = \"0.6\";\r\n        w.value = list;\r\n      });\r\n\r\n      requestAnimationFrame(() => {\r\n        if (!nodeInstance.size) return;\r\n        const sz = nodeInstance.computeSize();\r\n        sz[0] = Math.max(sz[0], nodeInstance.size[0]);\r\n        sz[1] = Math.max(sz[1], nodeInstance.size[1]);\r\n        nodeInstance.onResize?.(sz);\r\n        app.graph.setDirtyCanvas(true, false);\r\n      });\r\n    };\r\n\r\n    const originalOnExecuted = nodeType.prototype.onExecuted;\r\n    nodeType.prototype.onExecuted = function (data) {\r\n      originalOnExecuted?.apply(this, arguments);\r\n      debugString(this, data.content);\r\n    };\r\n\r\n    const originalOnConfigure = nodeType.prototype.onConfigure;\r\n    nodeType.prototype.onConfigure = function () {\r\n      originalOnConfigure?.apply(this, arguments);\r\n      if (this.widgets_values?.length > 1) {\r\n        debugString(this, this.widgets_values.slice(1));\r\n      }\r\n    };\r\n  },\r\n};\r\n\r\napp.registerExtension(extension);\r\n"],"names":["app"],"mappings":";;AAIA,MAAM,YAA4B;AAAA,EAChC,MAAM;AAAA,EACN,uBAAuB,OAAO,UAAU,UAAUA,SAAQ;AACpD,QAAA,SAAS,SAAS,cAAe;AAE/B,UAAA,cAAc,CAAC,cAA4B,YAAoB;AAC/D,UAAA,CAAC,aAAa,QAAS;AAGd,mBAAA,QAAQ,MAAM,CAAC,EAAE,QAAQ,CAAU,WAAA,OAAO,YAAY;AACnE,mBAAa,QAAQ,SAAS;AAE9B,YAAM,SAAS,UAAU,CAAC,GAAG,OAAO,IAAI,CAAC;AACzC,aAAO,QAAQ,CAAQ,SAAA;AACrB,cAAM,IAAI,aAAa,QAAQ,EAAE,cAAc,WAAW,CAAC,UAAU,EAAE,WAAW,KAAM,CAAA,GAAGA,IAAG,EAAE;AAChG,UAAE,QAAQ,WAAW;AACnB,UAAA,QAAQ,MAAM,UAAU;AAC1B,UAAE,QAAQ;AAAA,MAAA,CACX;AAED,4BAAsB,MAAM;AACtB,YAAA,CAAC,aAAa,KAAM;AAClB,cAAA,KAAK,aAAa,YAAY;AACjC,WAAA,CAAC,IAAI,KAAK,IAAI,GAAG,CAAC,GAAG,aAAa,KAAK,CAAC,CAAC;AACzC,WAAA,CAAC,IAAI,KAAK,IAAI,GAAG,CAAC,GAAG,aAAa,KAAK,CAAC,CAAC;AAC5C,qBAAa,WAAW,EAAE;AAC1BA,aAAI,MAAM,eAAe,MAAM,KAAK;AAAA,MAAA,CACrC;AAAA,IACH;AAEM,UAAA,qBAAqB,SAAS,UAAU;AACrC,aAAA,UAAU,aAAa,SAAU,MAAM;AAC1B,0BAAA,MAAM,MAAM,SAAS;AAC7B,kBAAA,MAAM,KAAK,OAAO;AAAA,IAChC;AAEM,UAAA,sBAAsB,SAAS,UAAU;AACtC,aAAA,UAAU,cAAc,WAAY;AACtB,2BAAA,MAAM,MAAM,SAAS;AACtC,UAAA,KAAK,gBAAgB,SAAS,GAAG;AACnC,oBAAY,MAAM,KAAK,eAAe,MAAM,CAAC,CAAC;AAAA,MAAA;AAAA,IAElD;AAAA,EAAA;AAEJ;AAEA,IAAI,kBAAkB,SAAS;"}